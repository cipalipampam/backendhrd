generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model departemen {
  id        String     @id
  nama      String     @unique(map: "Departemen_nama_key")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  jabatan   jabatan[]
  karyawan  karyawan[] @relation("departemenonkaryawan")
}

model featuresnapshot {
  id             String       @id
  karyawanId     String
  features       Json
  modelVersionId String
  createdAt      DateTime     @default(now())
  modelversion   modelversion @relation(fields: [modelVersionId], references: [id], map: "FeatureSnapshot_modelVersionId_fkey")

  @@index([modelVersionId], map: "FeatureSnapshot_modelVersionId_fkey")
}

model jabatan {
  id           String     @id
  nama         String
  level        String?    // "Junior", "Staff", "Senior", "Lead", "Manager", "Director"
  departemenId String
  deskripsi    String?    @db.Text
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  departemen   departemen @relation(fields: [departemenId], references: [id], map: "Jabatan_departemenId_fkey")
  karyawan     karyawan[] @relation("jabatanonkaryawan")

  @@unique([nama, departemenId], map: "Jabatan_nama_departemenId_key")
  @@index([departemenId], map: "Jabatan_departemenId_idx")
}

model karyawan {
  id              String            @id
  nama            String
  gender          karyawan_gender
  alamat          String?
  no_telp         String?
  tanggal_lahir   DateTime?
  pendidikan      String
  tanggal_masuk   DateTime
  jalur_rekrut    String
  userId          String            @unique(map: "Karyawan_userId_key")
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  user            user              @relation(fields: [userId], references: [username], map: "Karyawan_userId_fkey")
  kpi             kpi[]
  pelatihandetail pelatihandetail[]
  rating          rating[]
  kehadiran       kehadiran[]
  izinRequest     izinRequest[]
  departemen      departemen[]      @relation("departemenonkaryawan")
  jabatan         jabatan[]         @relation("jabatanonkaryawan")
  penghargaan     penghargaan[]     @relation("penghargaanonkaryawan")
}

model kpi {
  id         String       @id
  year       Int
  score      Float
  karyawanId String
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  karyawan   karyawan     @relation(fields: [karyawanId], references: [id], map: "KPI_karyawanId_fkey")

  kpiDetails kpiDetail[]  @relation("kpi_kpiDetail")
}

model kpiIndicator {
  id          String      @id @default(cuid())
  nama        String
  deskripsi   String?
  bobot       Float       // misal 0.3 = 30%
  departemenId String?    // opsional
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  kpiDetails  kpiDetail[] @relation("indicator_kpiDetail")
}

model kpiDetail {
  id           String   @id @default(cuid())
  kpiId        String
  indikatorId  String
  target       Float
  realisasi    Float?
  score        Float?   // (realisasi/target) * bobot * 100
  periodeYear  Int?     // Tahun periode KPI (bisa dimanipulasi terpisah dari createdAt)
  periodeMonth Int?     // Bulan periode KPI (1-12)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  kpi          kpi           @relation("kpi_kpiDetail", fields: [kpiId], references: [id], map: "KpiDetail_kpiId_fkey")
  indikator    kpiIndicator  @relation("indicator_kpiDetail", fields: [indikatorId], references: [id], map: "KpiDetail_indikatorId_fkey")

  @@index([kpiId], map: "KpiDetail_kpiId_idx")
  @@index([indikatorId], map: "KpiDetail_indikatorId_idx")
  @@index([periodeYear, periodeMonth], map: "KpiDetail_periode_idx")
}

model modelversion {
  id                      String                    @id
  name                    String
  version                 Int
  type                    String
  storagePath             String
  metrics                 Json?
  createdAt               DateTime                  @default(now())
  featuresnapshot         featuresnapshot[]
  promotionrecommendation promotionrecommendation[]
}

model pelatihan {
  id              String            @id
  nama            String
  tanggal         DateTime
  lokasi          String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  pelatihandetail pelatihandetail[]
}

model pelatihandetail {
  id          String    @id
  pelatihanId String
  karyawanId  String
  skor        Float?
  catatan     String?
  periodeYear  Int?     // Tahun periode pelatihan (bisa dimanipulasi terpisah dari createdAt)
  periodeMonth Int?     // Bulan periode pelatihan (1-12)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  karyawan    karyawan  @relation(fields: [karyawanId], references: [id], map: "PelatihanDetail_karyawanId_fkey")
  pelatihan   pelatihan @relation(fields: [pelatihanId], references: [id], map: "PelatihanDetail_pelatihanId_fkey")

  @@unique([pelatihanId, karyawanId], map: "PelatihanDetail_pelatihanId_karyawanId_key")
  @@index([karyawanId], map: "PelatihanDetail_karyawanId_fkey")
  @@index([periodeYear, periodeMonth], map: "PelatihanDetail_periode_idx")
}

model penghargaan {
  id        String     @id
  nama      String
  tahun     DateTime
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  karyawan  karyawan[] @relation("penghargaanonkaryawan")
}

model promotionrecommendation {
  id             String       @id
  karyawanId     String
  modelVersionId String
  score          Float
  recommend      Boolean
  reasons        Json?
  createdAt      DateTime     @default(now())
  modelversion   modelversion @relation(fields: [modelVersionId], references: [id], map: "PromotionRecommendation_modelVersionId_fkey")

  @@index([modelVersionId], map: "PromotionRecommendation_modelVersionId_fkey")
}

model rating {
  id         String   @id
  year       Int
  score      Float
  notes      String?
  karyawanId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  karyawan   karyawan @relation(fields: [karyawanId], references: [id], map: "Rating_karyawanId_fkey")

  @@unique([karyawanId, year], map: "Rating_karyawanId_year_key")
}

model user {
  username  String    @id
  email     String    @unique(map: "User_email_key")
  role      user_role @default(KARYAWAN)
  password  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  karyawan  karyawan?
}

enum karyawan_gender {
  Pria
  Wanita
}

model kehadiran {
  id           String            @id @default(cuid())
  karyawanId   String
  tanggal      DateTime          @default(now())
  waktuMasuk   DateTime?
  waktuKeluar  DateTime?
  status       kehadiran_status  @default(BELUM_ABSEN)
  lokasi       String?
  keterangan   String?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  karyawan     karyawan          @relation(fields: [karyawanId], references: [id], map: "Kehadiran_karyawanId_fkey")

  @@unique([karyawanId, tanggal], map: "Kehadiran_karyawanId_tanggal_key")
  @@index([karyawanId], map: "Kehadiran_karyawanId_idx")
}

enum kehadiran_status {
  HADIR
  TERLAMBAT
  IZIN
  SAKIT
  ALPA
  BELUM_ABSEN
}

model izinRequest {
  id          String         @id @default(cuid())
  karyawanId  String
  tanggal     DateTime
  jenis       izin_jenis
  keterangan  String?
  fileUrl     String?
  status      izin_status    @default(PENDING)
  approvedBy  String?
  approvedAt  DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  karyawan    karyawan       @relation(fields: [karyawanId], references: [id], map: "IzinRequest_karyawanId_fkey")

  @@index([karyawanId], map: "IzinRequest_karyawanId_idx")
}

enum izin_status {
  PENDING
  APPROVED
  REJECTED
}

enum izin_jenis {
  IZIN
  SAKIT
}

enum user_role {
  KARYAWAN
  HR
}
