generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "mysql"
  url       = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL")
}

enum Role {
  KARYAWAN
  HR
}

enum Gender {
  Pria
  Wanita
}

model User {
  username        String   @id
  email     String   @unique
  role      Role     @default(KARYAWAN)
  password  String
  karyawan  Karyawan?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Departemen {
  id        String     @id @default(cuid())
  nama      String     @unique
  Karyawan  Karyawan[] @relation("DepartemenOnKaryawan")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Jabatan {
  id        String     @id @default(cuid())
  nama      String     @unique
  Karyawan  Karyawan[] @relation("JabatanOnKaryawan")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model KPI {
  id         String   @id @default(cuid())
  year       Int
  score      Float
  notes      String?
  karyawanId String
  karyawan   Karyawan @relation(fields: [karyawanId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([karyawanId, year])
}

model Rating {
  id         String   @id @default(cuid())
  year       Int
  score      Float
  notes      String?
  karyawanId String
  karyawan   Karyawan @relation(fields: [karyawanId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([karyawanId, year])
}

model Penghargaan {
  id        String       @id @default(cuid())
  nama      String
  tahun     DateTime
  Karyawan  Karyawan[]   @relation("PenghargaanOnKaryawan")
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model Pelatihan {
  id        String            @id @default(cuid())
  nama      String
  tanggal   DateTime
  lokasi    String
  peserta   PelatihanDetail[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PelatihanDetail {
  id          String    @id @default(cuid())
  pelatihanId String
  karyawanId  String
  skor        Float?
  catatan     String?

  pelatihan   Pelatihan @relation(fields: [pelatihanId], references: [id])
  karyawan    Karyawan  @relation(fields: [karyawanId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([pelatihanId, karyawanId])
}

model Karyawan {
  id               String            @id @default(cuid())
  nama             String
  gender           Gender
  alamat           String?
  no_telp          String?
  tanggal_lahir    DateTime?
  pendidikan       String
  tanggal_masuk    DateTime
  jalur_rekrut     String
  penghargaan      Penghargaan[]    @relation("PenghargaanOnKaryawan")
  Departemen       Departemen[]     @relation("DepartemenOnKaryawan")
  Jabatan          Jabatan[]        @relation("JabatanOnKaryawan")
  KPI              KPI[]            // 1 karyawan -> banyak KPI
  Rating           Rating[]         // 1 karyawan -> banyak Rating
  pelatihanDetail  PelatihanDetail[]
  userId           String           @unique
  user             User             @relation(fields: [userId], references: [username])
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
}

// --- XGBoost Promotion AI Models ---

model ModelVersion {
  id               String                   @id @default(cuid())
  name             String
  version          Int
  type             String
  storagePath      String
  metrics          Json?
  createdAt        DateTime                 @default(now())
  FeatureSnapshots FeatureSnapshot[]
  Recommendations  PromotionRecommendation[]
}

model FeatureSnapshot {
  id             String       @id @default(cuid())
  karyawanId     String
  features       Json
  modelVersionId String
  modelVersion   ModelVersion @relation(fields: [modelVersionId], references: [id])
  createdAt      DateTime     @default(now())
}

model PromotionRecommendation {
  id             String       @id @default(cuid())
  karyawanId     String
  modelVersionId String
  modelVersion   ModelVersion @relation(fields: [modelVersionId], references: [id])
  score          Float
  recommend      Boolean
  reasons        Json?
  createdAt      DateTime     @default(now())
}